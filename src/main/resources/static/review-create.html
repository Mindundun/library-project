<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>독후감 작성</title>

<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f9f9f9;
    color: #333;
    margin: 40px;
  }

  h1 {
    color: #2c3e50;
    margin-bottom: 20px;
  }

  .container {
    width: 600px;
    background-color: #fff;
    padding: 25px 30px;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    margin: 0 auto;
  }

  label {
    display: block;
    font-size: 18px;
    color: #34495e;
    margin-bottom: 8px;
  }

  textarea {
    width: 100%;
    height: 200px;
    padding: 12px;
    font-size: 16px;
    resize: vertical;
    border-radius: 4px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }

  .actions {
    margin-top: 20px;
    text-align: right;
  }

  button {
    background-color: #3498db;
    border: none;
    color: white;
    padding: 12px 28px;
    margin-left: 10px;
    font-size: 16px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
  }

  button:hover {
    background-color: #2980b9;
  }

  #cancel-btn {
    background-color: #95a5a6;
  }

  #cancel-btn:hover {
    background-color: #7f8c8d;
  }
</style>
</head>
<body>

<div class="container">
  <h1>독후감 작성</h1>

  <input type="hidden" id="book-id">

  <label for="content">내용</label>
  <textarea id="content" placeholder="독후감을 입력하세요"></textarea>

  <div class="actions">
    <button id="cancel-btn">취소</button>
    <button id="submit-btn">등록</button>
  </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const bookId = params.get('bookId');

// bookId hidden input에 저장
document.getElementById('book-id').value = bookId;

if (!bookId) {
  alert("bookId가 없습니다.");
  history.back();
}

// 등록 버튼 클릭
document.getElementById('submit-btn').addEventListener('click', () => {
  const content = document.getElementById('content').value.trim();

  if (content.length === 0) {
    alert("내용을 입력해주세요.");
    return;
  }

  const body = {
    content: content,
    parantBookId: Number(bookId)
  };

  fetch('/api/v1/bookDetailReviews', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  })
  .then(res => {
    if (!res.ok) throw new Error('등록 실패');
    return res.json();
  })
  .then(data => {
    alert("독후감이 등록되었습니다.");
    window.location.href = `/book-detail.html?id=${bookId}`;
  })
  .catch(err => alert("오류 발생: " + err.message));
});

// 취소 버튼
document.getElementById('cancel-btn').addEventListener('click', () => {
  if (bookId) window.location.href = `/book-detail.html?id=${bookId}`;
  else window.location.href = `/index.html`;
});
</script>

</body>
</html>
